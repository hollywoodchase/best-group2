<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Chrissy's Page</title>
    <link rel="stylesheet" type="text/css" href="assets/css/style.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <!-- Font Awesome CSS Icons (For cool glyphicons) -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" />
</head>

<body>

    <div class="jumbotron jumbotron-fluid">
        <div class="container">
            <h1 class="display-4">Where should you go tonight?</h1>

            <form class="form-inline">
                    <div class="row">
                <div class="form-group mb-2">
                    <label for="City" class="sr-only">City</label>
                    <input id="city-input" type="text" size="50" class="form-control" id="city" placeholder="Location">
                </div>
                <div class="form-group mb-2">
                    <label for="date" class="sr-only">Date</label>
                    <input id="date-input" type="date" class="form-control" id="date">
                </div>
                <button type="submit" id="submit-button" class="btn btn-primary mb-2"><i class="fa fa-search"></i>
                </button>
            </div>
            </form>


        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <!-- Moment.js Link -->
    <script src="https://cdn.jsdelivr.net/momentjs/2.12.0/moment.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/6.0.4/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/6.0.4/firebase-database.js"></script>
    <script src="assets/scripts/script.js"></script>

    <script>

        // On push of the submit button, take the value of the city
        var proTeams = [];
        var gameTonight = false;
        var cityTeamsTonight = [];
        var cityTeams = [];
        var sportsTeams = [];
        var getAvailableTeams = function (city) {
            var queryURLTeams = 'https://www.thesportsdb.com/api/v1/json/1/searchteams.php?t=' + city;
            $.get(queryURLTeams).then(function (response) {
                cityTeams = response.teams;
                var leagues = ["NFL", "NBA", "NHL", "MLB"];
                for (let i = 0; i < cityTeams.length; i++) {
                    if (leagues.indexOf(cityTeams[i].strLeague) !== -1) {
                        proTeams.push(cityTeams[i].strTeam);
                    }
                }
            });
        }
        var getEventsBySport = function (sportsID, date) {
            var settings = {
                "async": true,
                "crossDomain": true,
                "url": "https://therundown-therundown-v1.p.rapidapi.com/sports/" + sportsID + "/events/" + date + "?include=all_periods&include=scores",
                "method": "GET",
                "headers": {
                    "x-rapidapi-host": "therundown-therundown-v1.p.rapidapi.com",
                    "x-rapidapi-key": "1eb7eadabemshf0789dca576eb58p1442aejsnece09022835e"
                }
            }
            $.ajax(settings).done(function (response) {
                var events = response.events;
                // console.log(events);
                for (let i = 0; i < events.length; i++) {
                    var teams = events[i].teams;
                    for (let j = 0; j < teams.length; j++) {
                        sportsTeams.push(teams[j].name);
                    }
                }
                // console.log(sportsTeams);
                for (let j = 0; j < sportsTeams.length; j++) {
                    // if (proTeams.indexOf(sportsTeams[j]) !== -1) {
                    // if (cityTeamsTonight.indexOf(baseballTeams[j] === -1)) {
                    // cityTeamsTonight.push(sportsTeams[j]);
                    // }
                    // };
                    if (proTeams.includes(sportsTeams[j])) {
                        gameTonight = true;
                        console.log("Your team is playing tonight");
                        cityTeamsTonight.push(sportsTeams[j]);
                    } else {
                        console.log("Your team is NOT playing tonight");
                    }
                }
                console.log(cityTeamsTonight);
            });
        }
        $('#submit-button').on('click', function () {
            event.preventDefault();
            var userCity = $('#city-input').val().trim();
            var date = $('#date-input').val().trim();
            getAvailableTeams(userCity);
            getEventsBySport(3, date);
        });

    </script>

</body>

</html>